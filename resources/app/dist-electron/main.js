"use strict";const t=require("electron"),M=require("path"),d=require("process");function k(a){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const i in a)if(i!=="default"){const o=Object.getOwnPropertyDescriptor(a,i);Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>a[i]})}}return n.default=a,Object.freeze(n)}const m=k(M),x="AttackShark",P={currentCompany:x},w=require("@electron/remote/main");w.initialize();let e=null;const C=1595,p=830;let h=1;const g=()=>{const a=t.screen.getPrimaryDisplay().size,i=Math.round(a.height*.75)/p;h=i>1?1:i,e=new t.BrowserWindow({transparent:!0,width:Math.round(C*h),height:Math.round(p*h),backgroundColor:"#00ffffff",center:!0,frame:!1,resizable:!1,fullscreenable:!1,show:!1,webPreferences:{nodeIntegration:!0,contextIsolation:!1,webSecurity:t.app.isPackaged?void 0:!1}}),d.platform==="darwin"&&e.setWindowButtonVisibility(!1),t.app.isPackaged||e.webContents.openDevTools(),t.app.isPackaged?(console.log("in prod:",m.join(__dirname,"..","dist","index.html")),e.loadFile(m.join(__dirname,"..","dist","index.html"))):e.loadURL("http://localhost:8080"),e.on("hide",()=>{e==null||e.webContents.send("hide",!0)}),e.on("show",()=>{e==null||e.webContents.send("show",!0)}),e.on("closed",async()=>e=null),e.on("ready-to-show",function(){e==null||e.webContents.send("ready-to-show",!0),e&&e.show()}),e.webContents.on("crashed",(o,s)=>{}),w.enable(e.webContents)},z=t.app.requestSingleInstanceLock();z?t.app.on("second-instance",(a,n,i)=>{e&&e.show()}):t.app.quit();t.app.commandLine.appendSwitch("no-sandbox");t.app.commandLine.appendSwitch("disable-background-timer-throttling");t.app.on("ready",()=>{e==null||e.webContents.send("ready",!0),T(),g(),t.app.isPackaged&&t.Menu.setApplicationMenu(null),d.platform});t.app.on("window-all-closed",()=>{d.platform!=="darwin"&&t.app.quit()});t.app.on("activate",()=>{e===null&&g()});let r;const y=[{label:"显示",click:()=>{e&&e.show()}},{label:"隐藏",click:()=>{e&&e.hide()}},{label:"退出",click:()=>{e&&(e==null||e.webContents.send("exit",!0))}}];t.ipcMain.on("international",(a,n)=>{if(r===void 0)return;const i=new Array;n.map((o,s)=>{const c=y[s];c.label=o,i.push(c)}),i.splice(2,0,{type:"separator"}),r.setContextMenu(t.Menu.buildFromTemplate(i))});t.ipcMain.on("setToolTip",(a,n)=>{r!==void 0&&r.setToolTip(`${n}`)});t.ipcMain.on("getOpenAtLogin",a=>{e==null||e.webContents.send("getOpenAtLogin",t.app.getLoginItemSettings().openAtLogin)});t.ipcMain.on("setOpenAtLogin",(a,n)=>{t.app.setLoginItemSettings({openAtLogin:n,openAsHidden:!0,path:d.execPath})});t.ipcMain.on("getScaleFactor",a=>{console.error("acccept getScaleFactor!!!",t.screen.getPrimaryDisplay().scaleFactor),a.returnValue=t.screen.getPrimaryDisplay().scaleFactor});t.ipcMain.handle("window-unmaximize",async a=>{const n=t.BrowserWindow.fromWebContents(a.sender);if(n){console.error("window-unmaximizestart-----");try{const o=t.screen.getDisplayMatching(n.getBounds()).workArea,s=1595,c=830;console.error("window-unmaximizestart-----",n.isMaximized()),n.isMaximized()&&(n.unmaximize(),await new Promise(u=>setTimeout(u,50))),n.setBounds({width:1e3,height:700,x:Math.floor(o.x+(o.width-1e3)/2),y:Math.floor(o.y+(o.height-700)/2)}),await new Promise(u=>setTimeout(u,50));const b=t.screen.getPrimaryDisplay().size,f=Math.round(b.height*.75),l=f/p>1?1:f/p;n.setBounds({width:Math.round(s*l),height:Math.round(c*l),x:Math.floor(o.x+(o.width-s*l)/2),y:Math.floor(o.y+(o.height-c*l)/2)}),n.isVisible()||n.show(),n.webContents.invalidate()}catch(i){console.error("Window unmaximize failed:",i);try{n.minimize(),await new Promise(o=>setTimeout(o,100)),n.restore(),await new Promise(o=>setTimeout(o,100)),n.setSize(1595,830),n.center()}catch(o){console.error("Fallback method also failed:",o)}}}});const T=()=>{if(r===void 0){const a=P.currentCompany,n=m.join(__dirname,"..","company","company_"+a,"APP.png");let i=t.nativeImage.createFromPath(n);i=i.resize({width:18,height:18}),r=new t.Tray(i),r.addListener("click",s=>{e&&e.show()});const o=[...y];o.splice(2,0,{type:"separator"}),r.setContextMenu(t.Menu.buildFromTemplate(o))}};
